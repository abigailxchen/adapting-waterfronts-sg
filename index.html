<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Adapting Waterfronts Walking Tour</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans"
      rel="stylesheet"
    />
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.14.0/mapbox-gl.js"></script>
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v3.14.0/mapbox-gl.css"
      rel="stylesheet"
    />

    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: 'Open Sans', sans-serif;
      }

      /* Modal background overlay */
      #introOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1100; /* increased above topNav */
      }

      /* Modal content box */
      #introModal {
        background: white;
        padding: 2em;
        border-radius: 12px;
        max-width: 400px;
        width: 80%;
        text-align: center;
      }


      #introModal h1 {
        font-size: 1.8em;
        margin-bottom: 1em;
      }

      #introModal p {
        margin-bottom: 1.5em;
        line-height: 1.4;
      }

      #startBtn {
        padding: 10px 20px;
        font-size: 1.1em;
        border: none;
        border-radius: 8px;
        background: #0077cc;
        color: white;
        cursor: pointer;
      }

      #startBtn:hover {
        background: #005fa3;
      }

      /* Map */
      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
      }

        .marker {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        background: #222567;
        color: white;
        font-size: 16px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        border: 2px solid white;
        box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }

      .mapboxgl-popup {
        max-width: 400px;
      }

      .mapboxgl-popup-content {
        text-align: center;
        overflow-y: auto;
      }

      .mapboxgl-popup-close-button {
        font-size: 2em !important;   /* larger √ó */
        width: 44px !important;      /* bigger tap target */
        height: 44px !important;
        line-height: 44px !important;
        border-radius: 50%;
      }
      .mapboxgl-popup-close-button:hover,
      .mapboxgl-popup-close-button:focus {
        background: rgba(0,0,0,0.05);
      }

      /* Menu button */
      #menu {
        position: absolute;
        top: 15px;
        right: 15px;
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        z-index: 998;
      }

      #menu button {
        display: block;
        padding: 10px 15px;
        width: 100%;
        border: none;
        background: white;
        cursor: pointer;
        text-align: left;
      }

      #menu button:hover {
        background: #f0f0f0;
      }

      /* Info overlays */
      .infoOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.6);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1100;
      }

      .infoContent {
        background: white;
        padding: 2em;
        border-radius: 12px;
        max-width: 500px;
        width: 90%;
        text-align: left;
        position: relative;
      }

      .closeBtn {
        position: absolute;
        top: 12px;
        right: 12px;
        background: transparent;
        border: none;
        font-size: 2em;              /* bigger "√ó" */
        line-height: 1;
        cursor: pointer;
        width: 44px;                 /* min recommended touch target */
        height: 44px;                /* min recommended touch target */
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;          /* optional: circular hit area */
      }
      
      /* Remove hover effect completely */
      .mapboxgl-popup-close-button,
      .mapboxgl-popup-close-button:hover,
      .mapboxgl-popup-close-button:focus,
      .mapboxgl-popup-close-button:active {
          background: transparent !important;  /* no hover color */
      }

      /* Top Navigation Bar */
      #topNav {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 60px;
        background: rgba(255,255,255,0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1002;
        /* box-shadow: 0 2px 6px rgba(0,0,0,0.2); */
      }

      #logo {
        font-size: 1.1em;
        font-weight: bold;
        text-align: center;
      }

      #infoBtn {
        position: absolute;
        right: 15px;
        background: transparent;
        border: none;
        font-size: 1.5em;
        cursor: pointer;
      }

    </style>
  </head>

  <body>
      <!-- Intro Modal -->
      <div id="introOverlay" style="display:flex;">
      <div id="introModal">
          <h1>Welcome to the Adapting Waterfronts Augmented Reality Tour!</h1>
          <p>This is a guided augmented reality tour along the historic shoreline.</p>
          <p>
          Here‚Äôs how to get started: <br><br>
          Step 1. Download <a href="https://apps.apple.com/us/app/adobe-aero/id1401748913">Adobe Aero</a>.<br>
          Step 2. Click on map markers and hold the QR code to be redirected to the AR experience.<br>
          Step 3. Enjoy and don't walk into the middle of the road!<br>
          </p>
          <button id="startBtn">Start</button>
      </div>
      </div>

    <!-- Top Navigation Bar -->
    <div id="topNav">
      <div id="logo">üåä Adapting Waterfronts</div>
      <button id="infoBtn">‚ÑπÔ∏è</button>
    </div>

    <!-- Combined Info Overlay -->
    <div id="infoOverlay" class="infoOverlay">
      <div class="infoContent">
        <button class="closeBtn">&times;</button>
        <h2>Getting Started</h2>
        <p>Step 1. Download <a href="https://apps.apple.com/us/app/adobe-aero/id1401748913">Adobe Aero</a>.</p>
        <p>Step 2. Click on map markers and hold the QR code to be redirected to the AR experience.</p>
        <p>Step 3. Enjoy and don't walk into the middle of the road!</p>

        <h2>About</h2>
        <p>This project is a guided augmented reality tour along the historic shoreline. It invites the public to explore the past, present, and potential future transformations of the city's shoreline by visualizing place-based changes at 8 designated locations.</p>
        <p>Created by Gabriel Tenaya Kaprielian</p>
        <p>Website by Abigail Chen</p>
      </div>
    </div>


    <!-- Map -->
    <div id="map"></div>

    <script>
      // Custom access token for github website
      mapboxgl.accessToken = 'pk.eyJ1IjoiZ3NjYWxlczEiLCJhIjoiY21mYnJoN3R1MTd0MTJscTJsbHBzYjRxMCJ9.cumfjtafRFRLWWKQOUkAfg';

      // Create map
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/light-v11',
            center: [-122.39867, 37.79268],
            zoom: 14.15
        });

        // Add geolocate
        const geolocate = new mapboxgl.GeolocateControl({
            positionOptions: {
                enableHighAccuracy: true
            },
            trackUserLocation: true,
            showUserHeading: true
        });

        map.addControl(geolocate);

        // Intro modal logic
        const introOverlay = document.getElementById("introOverlay");
        const startBtn = document.getElementById("startBtn");

        startBtn.addEventListener("click", () => {
        introOverlay.style.display = "none"; // completely hide intro overlay
        // Trigger geolocation
        geolocate.trigger(); // will prompt the user to share location
        });

      // Top nav info button logic
      const infoBtn = document.getElementById("infoBtn");
      const infoOverlay = document.getElementById("infoOverlay");
      const closeBtn = infoOverlay.querySelector(".closeBtn");

      infoBtn.addEventListener("click", () => {
        infoOverlay.style.display = "flex";
      });

      closeBtn.addEventListener("click", () => {
        infoOverlay.style.display = "none";
      });

        // Load points
        const geojson = {
            type: 'FeatureCollection',
            features: [
                {
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [-122.400652, 37.787491]
                },
                properties: {
                    title: 'Mission & New Montgomery',
                    description: "You're standing on top of a costal sand dune prairire. How many native dune plants and animals can you name? Where are there existing dune ecosystems in San Francisco?",
                    picture: '1_GIF.gif',
                    instructions: "Hold the QR code and click 'Open' to jump in!",
                    qr: '1_AR_QR.png'

                }
                },
                {
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [-122.397661, 37.789759]
                },
                properties: {
                    title: 'Mission & 1st Street',
                    description: 'You are standing on the historic shoreline of San Francisco! Can you imagine what it looked like at this beach before the city was built?',
                    picture: '2_GIF.gif',
                    instructions: "Hold the QR code and click 'Open' to jump in!",
                    qr: '2_AR_QR.png'

                }
                },
                {
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [-122.399196, 37.791108]
                },
                properties: {
                    title: 'Market & 1st Street',
                    description: 'Canals can be used as part of a larger adaptation strategy for coastal cities facing sea level rise. They can intercept and store excess water during heavy rainfall, reducing the risk of flooding in coastal areas. Can you envision canals replacing some streets in San Francisco?',
                    picture: '3_GIF.gif',
                    instructions: "Hold the QR code and click 'Open' to jump in!",
                    qr: '3_AR_QR.png'
                }
                },
                {
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [-122.399804, 37.792270]
                },
                properties: {
                    title: 'Battery & Pine Street',
                    description: "If you were standing here in the early 1800s you would be knee deep in water. What tidal ecosystems have been covered by the city streets in San Francisco? How many San Francisco Bay intertidal plants and animals can you name? Where can you find tem around the city's shoreline?",
                    picture: '4_GIF.gif',
                    instructions: "Hold the QR code and click 'Open' to jump in!",
                    qr: '4_AR_QR.png'
                }
                },
                {
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [-122.402612, 37.791938]
                },
                properties: {
                    title: 'Pine & Montgomery Street',
                    description: 'Oak trees not only provide shade and shelter for many species but also play a significant role in carbon sequestration by absorbing and storing carbon from the atmosphere. By planting trees and grasses, cities can help lower the temperature and reduce the urban heat island. Imagine walking to work in downtown San Francisco through an oak woodland forest. How can that experience change your outlook on the day?',
                    picture: '5_GIF.gif',
                    instructions: "Hold the QR code and click 'Open' to jump in!",
                    qr: '5_AR_QR.png'
                }
                },
                {
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [-122.403187, 37.794671]
                },
                properties: {
                    title: 'Montgomery & Clay Street',
                    description: 'Sea-level rise will lead to compound flooding in costal communities by raising ground water levels, which increases flooding and damages infrastructure with saltwater. Would you swim in a giant saltwater pool in San Francisco? Where do people currently swim outdoors?',
                    picture: '6_GIF.gif',
                     instructions: "Hold the QR code and click 'Open' to jump in!",
                    qr: '6_AR_QR.png'

                }
                },
                {
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [-122.397819, 37.794443]
                },
                properties: {
                    title: 'Davis & Sacramento Street',
                    description: 'As sea levels rise, the areas that have been built on reclaimed land are some of the most vulnerable areas to flooding. What parts of San Francisco are constructed on bay fill? How can we reconsider the concept of a static shoreline as a flexible show area by embracing our relationship with the water?',
                    picture: '7_GIF.gif',
                    instructions: "Hold the QR code and click 'Open' to jump in!",
                    qr: '7_AR_QR.png'

                }
                },
                {
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [-122.395698, 37.793759]
                },
                properties: {
                    title: 'Market & Spear Street',
                    description: 'The Antarctic Ice Sheet extends nearly 5.4 million square miles, roughly the area of the contiuguous US and Mexico combined. The volume of the Antarctic Ice Sheet equates to 10 million cubic miles, with a mean thickness of 7,000 feet. If it all melted, global sea levels would rise over 190 feet. How many feet of sea level rise do you think would be too much for San Francisco to use walls as shoreline protection?',
                    picture: '8_GIF.gif',
                    instructions: "Hold the QR code and click 'Open' to jump in!", 
                    qr: '8_AR_QR.png'

                }
                }
            ]
            };

        // Add markers to map
        geojson.features.forEach((feature, index) => {
          // Create a HTML element for each location
          const el = document.createElement('div');
          el.className = 'marker';
          el.textContent = index + 1; // number markers chronologically

          // Create popup
          const popup = new mapboxgl.Popup({ offset: 25, maxWidth: '316px', anchor: 'bottom' })
            .setHTML(
              `<h3>${feature.properties.title}</h3>
              <p>${feature.properties.description}</p>
              ${feature.properties.picture ? `<img src="img/${feature.properties.picture}" style="max-width:100%">` : ""}
              <p>${feature.properties.instructions}</p>
              ${feature.properties.qr ? `<img src="img/${feature.properties.qr}" style="max-width:25%">` : ""}`
            );

          // Make a marker and add to the map
          const marker = new mapboxgl.Marker(el)
            .setLngLat(feature.geometry.coordinates)
            .setPopup(popup)
            .addTo(map);

          // When popup opens, recenter map so popup is visible and zoom if needed
          popup.on('open', () => {
            let targetZoom = map.getZoom();

            // On small screens, zoom in a little for readability
            if (window.innerWidth < 768 && targetZoom < 16) {
              targetZoom = 16; // adjust this zoom level as you like
            }

            map.easeTo({
              center: feature.geometry.coordinates,
              offset: [0, 300], // shift popup upward so it's not cut off
              zoom: targetZoom,
              duration: 900
            });
          });
        });

        map.on('load', () => {
          // Shoreline
          map.addSource('shoreline', {
            'type': 'vector',
            'url': 'mapbox://gscales1.1koo04dg' // Replace with Tileset ID
          });

          map.addLayer({
            'id': 'shoreline',
            'type': 'fill',
            'source': 'shoreline',
            'source-layer': 'bayfill_KML', // Replace with Tileset Vector Layer name
            'paint': {
              'fill-color': '#008080',
              'fill-opacity': 0.2
            }
          });

          // 6ft SLR
          map.addSource('6ftslr', {
            'type': 'vector',
            'url': 'mapbox://gscales1.2fbkgkhm' // Replace with Tileset ID
          });

          map.addLayer({
            'id': '6ftslr',
            'type': 'fill',
            'source': '6ftslr',
            'source-layer': '6ft_SLR_KML', // Replace with Tileset Vector Layer name
            'paint': {
              'fill-color': '#008080',
              'fill-opacity': 0.5
            }
          });

          // Route
          map.addSource('route', {
            'type': 'geojson',
            'data': {
              'type': 'Feature',
              'properties': {},
              'geometry': {
                'type': 'LineString',
                'coordinates': [
                  [-122.400517,37.78745],
                  [-122.397587,37.789784],
                  [-122.399158,37.791027],
                  [-122.399584,37.791348],
                  [-122.399789,37.792266],
                  [-122.402592,37.791905],
                  [-122.403138,37.79468],
                  [-122.398016,37.79534],
                  [-122.397809,37.794438],
                  [-122.396609,37.79459],
                  [-122.396324,37.793286],
                  [-122.395638, 37.793845]
                ]
              }
            }
          });

          map.addLayer({
            'id': 'route',
            'type': 'line',
            'source': 'route',
            'layout': {
              'line-join': 'round',
              'line-cap': 'round'
            },
            'paint': {
              'line-color': '#0acbf2',
              'line-width': 6
            }
          });
        });

    </script>
  </body>
</html>
