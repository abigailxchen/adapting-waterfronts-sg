<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Adapting Waterfronts Walking Tour</title>
    <link rel="icon" type="image/png" href="img/AW_Favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans"
      rel="stylesheet"
    />
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.14.0/mapbox-gl.js"></script>
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v3.14.0/mapbox-gl.css"
      rel="stylesheet"
    />

    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: 'Open Sans', sans-serif;
      }

      /* Fonts */
      @font-face {
        font-family: 'BogartAlt';
        src: url('fonts/BOGARTALTMEDIUMTRIAL.TTF') format('truetype'),
            url('fonts/BOGARTALTMEDIUMTRIAL.TTF') format('woff');
        font-weight: medium;
        font-style: normal;
      }

      @font-face {
        font-family: 'Satoshi';
        src: url('fonts/Satoshi-Regular.otf') format('opentype'),
            url('fonts/Satoshi-Regular.otf') format('woff');
        font-weight: normal;
        font-style: normal;
      }

      @font-face {
        font-family: 'Satoshi';
        src: url('fonts/Satoshi-Bold.otf') format('opentype'),
            url('fonts/Satoshi-Bold.otf') format('woff');
        font-weight: bold;
        font-style: normal;
      }

      /* Modal header */
      #introModal h1 {
        font-family: 'BogartAlt', serif; /* your custom font */
        font-size: 1.8em;
        line-height: 1.3; /* increase this if lines are too tight */
        margin-bottom: 1em;
      }

      /* Map popups header */
      .mapboxgl-popup-content h3 {
        font-size: 22px;
        font-family: 'BogartAlt', serif;
      }

      /* Info overlay headers */
      .infoContent h2 {
        font-family: 'BogartAlt', serif;
      }

      /* Paragraph text (modal, popup, info) */
      #introModal p,
      .mapboxgl-popup-content p,
      .infoContent p {
        font-family: 'Satoshi', sans-serif;
      }

      /* Start button text */
      #startBtn {
        font-family: 'Satoshi', sans-serif;
        font-weight: bold;  /* will use Satoshi-Bold.otf */
      }

      /* Modal background overlay */
      #introOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1100; /* increased above topNav */
      }

      /* Modal content box */
      #introModal {
        background: #FBF8F0;
        padding: 2em;
        border-radius: 12px;
        max-width: 400px;
        width: 80%;
        text-align: center;
      }


      #introModal h1 {
        font-size: 1.8em;
        margin-bottom: 1em;
      }

      #introModal p {
        margin-bottom: 1.5em;
        line-height: 1.4;
      }

      #startBtn {
        padding: 16px 60px;
        font-size: 1.1em;
        border: none;
        border-radius: 8px;
        background: #FFC31E;
        color: black;
        cursor: pointer;
      }

      #startBtn:hover {
        background: #F7D987;
      }

      /* Map */
      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
      }

        .marker {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        background: #363636;
        color: white;
        font-size: 16px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        border: 2px solid white;
        /* box-shadow: 0 0 5px rgba(0,0,0,0.3); */
        }

      .mapboxgl-popup {
        max-width: 400px;
        z-index: 1003;
      }

      /* Popup container */
      .mapboxgl-popup-content {
        background-color: #FBF8F0; /* beige */
        border-radius: 16px;       /* more rounded corners */
        padding: 12px 16px;        /* adjust padding if you like */
        font-family: sans-serif;   /* optional: match your site font */
        font-size: 14px;
        color: #333;               /* darker text for contrast */
      }

      /* Optional: popup tip (the little pointer triangle) */
      .mapboxgl-popup-tip {
        border-top-color: #FBF8F0 !important; /* beige pointer */
      }


      .mapboxgl-popup-close-button {
        font-size: 2em !important;   /* larger × */
        width: 44px !important;      /* bigger tap target */
        height: 44px !important;
        line-height: 44px !important;
        border-radius: 50%;
      }
      .mapboxgl-popup-close-button:hover,
      .mapboxgl-popup-close-button:focus {
        background: rgba(0,0,0,0.05);
      }

      #layerLegend {
        position: absolute;
        top: 70px;  /* sits below top nav (60px) */
        right: 15px;
        background: white;
        padding: 10px;
        border-radius: 8px;
        z-index: 1002;
        font-family: 'Satoshi', sans-serif;
    }

      /* Info overlays */
      .infoOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.6);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1100;
      }

      .infoContent {
        background: #FBF8F0;
        padding: 2em;
        border-radius: 12px;
        max-width: 500px;
        width: 90%;
        text-align: left;
        position: relative;
      }

      .closeBtn {
        position: absolute;
        top: 12px;
        right: 12px;
        background: transparent;
        border: none;
        font-size: 2em;              /* bigger "×" */
        line-height: 1;
        cursor: pointer;
        width: 44px;                 /* min recommended touch target */
        height: 44px;                /* min recommended touch target */
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;          /* optional: circular hit area */
      }
      
      /* Remove hover effect completely */
      .mapboxgl-popup-close-button,
      .mapboxgl-popup-close-button:hover,
      .mapboxgl-popup-close-button:focus,
      .mapboxgl-popup-close-button:active {
          background: transparent !important;  /* no hover color */
      }

      /* Top Navigation Bar */
      #topNav {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 60px;
        background: rgba(255,255,255);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1005;
      } 

      #logoImg {
        height: 30px;   /* fits within 60px nav bar */
        width: auto;
        display: block;
      }


      #infoBtn {
        position: absolute;
        right: 15px;
        background: transparent;
        border: none;
        font-size: 1.5em;
        cursor: pointer;
      }

      .qr-section {
        text-align: center;   /* centers instructions */
        margin-top: 12px;     /* spacing above the section */
      }

      .qr-section p {
        margin-bottom: 8px;   /* space between text and QR image */
      }

      .qr-code {
        display: block;
        margin: 0 auto;
        max-width: 25%;     /* keep it a reasonable size */
        height: auto;
      }


    </style>
  </head>

  <body>
      <!-- Intro Modal -->
      <div id="introOverlay" style="display:flex;">
      <div id="introModal">
          <h1>Welcome to the Adapting Waterfronts Augmented Reality Tour!</h1>
          <p>This is a guided augmented reality tour along the historic shoreline.</p>
          <p>
          Here’s how to get started: <br><br>
          Step 1. Download <a href="https://apps.apple.com/us/app/adobe-aero/id1401748913">Adobe Aero</a>.<br>
          Step 2. Click on map markers and hold the QR code to be redirected to the AR experience.<br>
          Step 3. Enjoy and don't walk into the middle of the road!<br>
          </p>
          <button id="startBtn">Start</button>
      </div>
      </div>

    <!-- Top Navigation Bar -->
    <div id="topNav">
      <a href="index.html">
        <img src="img/AW_Logo_Words.png" alt="Adapting Waterfronts logo" id="logoImg" />
      </a>
      <button id="infoBtn">ℹ️</button>
    </div>


    <!-- Combined Info Overlay -->
    <div id="infoOverlay" class="infoOverlay">
      <div class="infoContent">
        <button class="closeBtn">&times;</button>
        <h2>Getting Started</h2>
        <p>Step 1. Download <a href="https://apps.apple.com/us/app/adobe-aero/id1401748913">Adobe Aero</a>.</p>
        <p>Step 2. Click on map markers and hold the QR code to be redirected to the AR experience.</p>
        <p>Step 3. Enjoy and don't walk into the middle of the road!</p>

        <h2>About</h2>
        <p>This project is a guided augmented reality tour along the historic shoreline. It invites the public to explore the past, present, and potential future transformations of the city's shoreline by visualizing place-based changes at 8 designated locations.</p>
        <p>Created by Gabriel Tenaya Kaprielian</p>
        <p>Website by Abigail Chen</p>
      </div>
    </div>


    <!-- Map -->
    <div id="map"></div>

    <!-- Layer legend / toggle -->
    <div id="layerLegend">
      <input type="checkbox" id="shorelineCheckbox" checked>
      <label for="shorelineCheckbox" style="color:#000000;">Historic Shoreline</label><br>
      <input type="checkbox" id="slrCheckbox" checked>
      <label for="slrCheckbox" style="color:#000000;">6' Sea Level Rise</label><br>
    </div>



    <script>
      // Custom access token for github website
      mapboxgl.accessToken = 'pk.eyJ1IjoiZ3NjYWxlczEiLCJhIjoiY21mYnJoN3R1MTd0MTJscTJsbHBzYjRxMCJ9.cumfjtafRFRLWWKQOUkAfg';

      // Create map
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/light-v11',
            center: [-122.39867, 37.79268],
            zoom: 14.15
        });

        // Add geolocate
        const geolocate = new mapboxgl.GeolocateControl({
            positionOptions: {
                enableHighAccuracy: true
            },
            trackUserLocation: true,
            showUserHeading: true
        });

        map.addControl(geolocate);

        // Intro modal logic
        const introOverlay = document.getElementById("introOverlay");
        const startBtn = document.getElementById("startBtn");

        startBtn.addEventListener("click", () => {
        introOverlay.style.display = "none"; // completely hide intro overlay
        // Trigger geolocation
        geolocate.trigger(); // will prompt the user to share location
        });

      // Top nav info button logic
      const infoBtn = document.getElementById("infoBtn");
      const infoOverlay = document.getElementById("infoOverlay");
      const closeBtn = infoOverlay.querySelector(".closeBtn");

      infoBtn.addEventListener("click", () => {
        infoOverlay.style.display = "flex";
      });

      closeBtn.addEventListener("click", () => {
        infoOverlay.style.display = "none";
      });

        // Load points
        const geojson = {
            type: 'FeatureCollection',
            features: [
                {
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [-122.400652, 37.787491]
                },
                properties: {
                    title: 'Mission & New Montgomery',
                    description: "You're standing on top of a costal sand dune prairire. How many native dune plants and animals can you name? Where are there existing dune ecosystems in San Francisco?",
                    picture: '1_GIF.gif',
                    instructions: "Hold the QR code and click 'Open' to jump in!",
                    qr: '1_AR_QR.png'

                }
                },
                {
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [-122.397661, 37.789759]
                },
                properties: {
                    title: 'Mission & 1st Street',
                    description: 'You are standing on the historic shoreline of San Francisco! Can you imagine what it looked like at this beach before the city was built?',
                    picture: '2_GIF.gif',
                    instructions: "Hold the QR code and click 'Open' to jump in!",
                    qr: '2_AR_QR.png'

                }
                },
                {
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [-122.399196, 37.791108]
                },
                properties: {
                    title: 'Market & 1st Street',
                    description: 'Canals can be used as part of a larger adaptation strategy for coastal cities facing sea level rise. They can intercept and store excess water during heavy rainfall, reducing the risk of flooding in coastal areas. Can you envision canals replacing some streets in San Francisco?',
                    picture: '3_GIF.gif',
                    instructions: "Hold the QR code and click 'Open' to jump in!",
                    qr: '3_AR_QR.png'
                }
                },
                {
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [-122.399804, 37.792270]
                },
                properties: {
                    title: 'Battery & Pine Street',
                    description: "If you were standing here in the early 1800s you would be knee deep in water. What tidal ecosystems have been covered by the city streets in San Francisco? How many San Francisco Bay intertidal plants and animals can you name? Where can you find tem around the city's shoreline?",
                    picture: '4_GIF.gif',
                    instructions: "Hold the QR code and click 'Open' to jump in!",
                    qr: '4_AR_QR.png'
                }
                },
                {
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [-122.402612, 37.791938]
                },
                properties: {
                    title: 'Pine & Montgomery Street',
                    description: 'Oak trees not only provide shade and shelter for many species but also play a significant role in carbon sequestration by absorbing and storing carbon from the atmosphere. By planting trees and grasses, cities can help lower the temperature and reduce the urban heat island. Imagine walking to work in downtown San Francisco through an oak woodland forest. How can that experience change your outlook on the day?',
                    picture: '5_GIF.gif',
                    instructions: "Hold the QR code and click 'Open' to jump in!",
                    qr: '5_AR_QR.png'
                }
                },
                {
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [-122.403187, 37.794671]
                },
                properties: {
                    title: 'Montgomery & Clay Street',
                    description: 'Sea-level rise will lead to compound flooding in costal communities by raising ground water levels, which increases flooding and damages infrastructure with saltwater. Would you swim in a giant saltwater pool in San Francisco? Where do people currently swim outdoors?',
                    picture: '6_GIF.gif',
                     instructions: "Hold the QR code and click 'Open' to jump in!",
                    qr: '6_AR_QR.png'

                }
                },
                {
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [-122.397819, 37.794443]
                },
                properties: {
                    title: 'Davis & Sacramento Street',
                    description: 'As sea levels rise, the areas that have been built on reclaimed land are some of the most vulnerable areas to flooding. What parts of San Francisco are constructed on bay fill? How can we reconsider the concept of a static shoreline as a flexible show area by embracing our relationship with the water?',
                    picture: '7_GIF.gif',
                    instructions: "Hold the QR code and click 'Open' to jump in!",
                    qr: '7_AR_QR.png'

                }
                },
                {
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [-122.395698, 37.793759]
                },
                properties: {
                    title: 'Market & Spear Street',
                    description: 'The Antarctic Ice Sheet extends nearly 5.4 million square miles, roughly the area of the contiuguous US and Mexico combined. The volume of the Antarctic Ice Sheet equates to 10 million cubic miles, with a mean thickness of 7,000 feet. If it all melted, global sea levels would rise over 190 feet. How many feet of sea level rise do you think would be too much for San Francisco to use walls as shoreline protection?',
                    picture: '8_GIF.gif',
                    instructions: "Hold the QR code and click 'Open' to jump in!", 
                    qr: '8_AR_QR.png'

                }
                },
                {
                type: 'Feature',
                geometry: {
                  type: 'Point',
                  coordinates: [-122.39344, 37.79547] // Ferry Building coordinates
                },
                properties: {
                  title: 'Ferry Building',
                  description: "We're passing it on to Luiz at the Port of SF to continue the second part of the tour at the Ferry Building. Thank you for taking part in this AR walking tour! We would love to hear your thoughts in a brief survey below.",
                  picture: null,
                  instructions: null,
                  qr: null,
                  special: true  // flag to indicate this is a custom marker
                }
              }
            ]
            };

        // Add markers to map
        geojson.features.forEach((feature, index) => {
          let el;

          if (feature.properties.special) {
              // Create a custom flag marker for special locations
              el = document.createElement('div');
              el.style.backgroundImage = 'url(img/flag.png)';
              el.style.width = '40px';
              el.style.height = '40px';
              el.style.backgroundSize = 'contain';
              el.style.backgroundRepeat = 'no-repeat';
              el.style.cursor = 'pointer';
            } else {
              // Default numbered marker
              el = document.createElement('div');
              el.className = 'marker';
              el.textContent = index + 1; // number markers chronologically
            }

          // Create popup
          const popup = new mapboxgl.Popup({ offset: 25, maxWidth: '316px', anchor: 'bottom' })
            .setHTML(
              `<h3>${feature.properties.title}</h3>
              <p>${feature.properties.description}</p>
              ${feature.properties.picture ? `<img src="img/${feature.properties.picture}" style="max-width:100%">` : ""}
              ${feature.properties.instructions || feature.properties.qr ? `
                  <div class="qr-section">
                    ${feature.properties.instructions ? `<p>${feature.properties.instructions}</p>` : ""}
                    ${feature.properties.qr ? `<img src="img/${feature.properties.qr}" alt="QR Code" class="qr-code">` : ""}
                  </div>` : ""}`
            );

          // Make a marker and add to the map
          const marker = new mapboxgl.Marker(el)
            .setLngLat(feature.geometry.coordinates)
            .setPopup(popup)
            .addTo(map);

          // When popup opens, recenter map so popup is visible and zoom if needed
          popup.on('open', () => {
            let targetZoom = map.getZoom();

            // On small screens, zoom in a little for readability
            if (window.innerWidth < 768 && targetZoom < 16) {
              targetZoom = 16; // adjust this zoom level as you like
            }

            map.easeTo({
              center: feature.geometry.coordinates,
              offset: [0, 300], // shift popup upward so it's not cut off
              zoom: targetZoom,
              duration: 900
            });
          });
        });

        map.on('load', () => {
          // Shoreline
          map.addSource('shoreline', {
            'type': 'vector',
            'url': 'mapbox://gscales1.1koo04dg' // Replace with Tileset ID
          });

          map.addLayer({
            'id': 'shoreline',
            'type': 'fill',
            'source': 'shoreline',
            'source-layer': 'bayfill_KML', // Replace with Tileset Vector Layer name
            'paint': {
              'fill-color': '#FFC31E',
              'fill-opacity': 0.4
            }
          });

          // 6ft SLR
          map.addSource('6ftslr', {
            'type': 'vector',
            'url': 'mapbox://gscales1.2fbkgkhm' // Replace with Tileset ID
          });

          map.addLayer({
            'id': '6ftslr',
            'type': 'fill',
            'source': '6ftslr',
            'source-layer': '6ft_SLR_KML', // Replace with Tileset Vector Layer name
            'paint': {
              'fill-color': '#41A7FF',
              'fill-opacity': 0.7
            }
          });

          // Route
          map.addSource('route', {
            'type': 'geojson',
            'data': {
              'type': 'Feature',
              'properties': {},
              'geometry': {
                'type': 'LineString',
                'coordinates': [
                  [-122.400517,37.78745],
                  [-122.397587,37.789784],
                  [-122.399158,37.791027],
                  [-122.399584,37.791348],
                  [-122.399789,37.792266],
                  [-122.402592,37.791905],
                  [-122.403138,37.79468],
                  [-122.398016,37.79534],
                  [-122.397809,37.794438],
                  [-122.396609,37.79459],
                  [-122.396324,37.793286],
                  [-122.395638, 37.793845]
                ]
              }
            }
          });

          map.addLayer({
            'id': 'route',
            'type': 'line',
            'source': 'route',
            'layout': {
              'line-join': 'round',
              'line-cap': 'round'
            },
            'paint': {
              'line-color': '#363636',
              'line-width': 6
            }
          });
        });

        // Dashed line to Ferry Building
        // map.addSource('ferryRoute', {
        //   'type': 'geojson',
        //   'data': {
        //     'type': 'Feature',
        //     'properties': {},
        //     'geometry': {
        //       'type': 'LineString',
        //       'coordinates': [
        //         [-122.39562982501772,37.79384680176645],
        //         [-122.3934898866114,37.795529178841036]
        //       ]
        //     }
        //   }
        // });

        // map.addLayer({
        //   'id': 'ferryRoute',
        //   'type': 'line',
        //   'source': 'ferryRoute',
        //   'layout': {
        //     'line-join': 'round',
        //     'line-cap': 'round'
        //   },
        //   'paint': {
        //     'line-color': '#0acbf2',
        //     'line-width': 6,
        //     'line-dasharray': [2, 4] // 2px dash, 4px gap
        //   }
        // });

        // Layer toggle logic
        const shorelineCheckbox = document.getElementById('shorelineCheckbox');
        const slrCheckbox = document.getElementById('slrCheckbox');

        shorelineCheckbox.addEventListener('change', (e) => {
            map.setLayoutProperty(
                'shoreline',
                'visibility',
                e.target.checked ? 'visible' : 'none'
            );
        });

        slrCheckbox.addEventListener('change', (e) => {
            map.setLayoutProperty(
                '6ftslr',
                'visibility',
                e.target.checked ? 'visible' : 'none'
            );
        });


    </script>
  </body>
</html>
